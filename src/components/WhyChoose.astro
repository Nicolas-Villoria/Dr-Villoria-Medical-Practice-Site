---
// src/components/WhyChoose.astro
---

<!-- Curved separator -->
<div class="curved-separator">
  <svg viewBox="0 0 1440 120" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M0,60 Q360,0 720,60 T1440,60 L1440,120 L0,120 Z" fill="var(--color-primary)"/>
  </svg>
</div>

<section id="whychoose" class="why-choose-section">
  
  <div class="container">
    <h2 class="section-title transition-item">¿Por qué elegirme?</h2>
    
    <!-- Carousel container -->
    <div class="carousel-container">
      <button class="carousel-arrow carousel-arrow-left" aria-label="Anterior">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
      </button>
      
      <div class="carousel-wrapper">
        <div class="why-choose-grid">
          <div class="why-choose-item">
            <div class="item-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2Z"/><path d="M12 6v6l4 2"/></svg>
            </div>
            <h3 class="item-title">Más de 20 años de experiencia</h3>
            <p class="item-description">Amplia trayectoria en el diagnóstico y tratamiento de enfermedades digestivas, respaldada por una formación continua y actualizada.</p>
          </div>
          
          <div class="why-choose-item">
            <div class="item-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.42 4.58a5.4 5.4 0 0 0-7.65 0l-.77.78-.77-.78a5.4 5.4 0 0 0-7.65 0C1.46 6.7 1.33 10.28 4 13l8 8 8-8c2.67-2.72 2.54-6.3.42-8.42z"></path></svg>
            </div>
            <h3 class="item-title">Atención personalizada</h3>
            <p class="item-description">Cada paciente es único. Ofrezco un trato cercano y humano, dedicando el tiempo necesario para entender tus necesidades.</p>
          </div>
          
          <div class="why-choose-item">
            <div class="item-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
            </div>
            <h3 class="item-title">Investigación y docencia</h3>
            <p class="item-description">Autor de más de 50 publicaciones científicas y profesor en la UAB, garantizando tratamientos basados en la evidencia más reciente.</p>
          </div>
          
          <div class="why-choose-item">
            <div class="item-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
            </div>
            <h3 class="item-title">Tecnología avanzada</h3>
            <p class="item-description">Equipamiento de última generación para pruebas diagnósticas y procedimientos endoscópicos con máxima precisión.</p>
          </div>
          
          <div class="why-choose-item">
            <div class="item-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
            </div>
            <h3 class="item-title">Enfoque integral</h3>
            <p class="item-description">Coordinación con otros especialistas cuando es necesario, asegurando un cuidado completo y multidisciplinario.</p>
          </div>
          
          <div class="why-choose-item">
            <div class="item-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
            </div>
            <h3 class="item-title">Resultados comprobados</h3>
            <p class="item-description">Miles de pacientes satisfechos que han mejorado su calidad de vida gracias a un diagnóstico preciso y tratamiento efectivo.</p>
          </div>
        </div>
      </div>
      
      <button class="carousel-arrow carousel-arrow-right" aria-label="Siguiente">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
      </button>
    </div>
    
  </div>
  
  <!-- Doctor info block with improved styling -->
  <div class="doctor-info-block">
    <div class="container">
      <div class="doctor-info-content">
        <div class="doctor-image">
          <img src="/assets/profile-pic.png" alt="Dr. Albert Villoria" />
        </div>
        
        <div class="doctor-details">
          <h3 class="doctor-name">Dr. Albert Villoria</h3>
          <p class="doctor-title">Especialista en Aparato Digestivo</p>
          
          <div class="credentials-list">
            <div class="credential-item">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
              <span>Doctor en Medicina por la UAB con Premio Extraordinario</span>
            </div>
            <div class="credential-item">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
              <span>Fellow in Gastroenterology European Board (2006)</span>
            </div>
            <div class="credential-item">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
              <span>Profesor Asociado en la Facultad de Medicina UAB</span>
            </div>
            <div class="credential-item">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
              <span>Miembro de la Academia de Ciencias Médicas de Catalunya</span>
            </div>
            <div class="credential-item">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
              <span>Más de 50 publicaciones en revistas científicas internacionales</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- Curved separator -->
<div class="curved-separator">
  <svg viewBox="0 0 1440 120" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M0,60 Q360,0 720,60 T1440,60 L1440,120 L0,120 Z" fill="white"/>
  </svg>
</div>

<style>
  .curved-separator {
    position: relative;
    width: 100%;
    height: 120px;
    overflow: hidden;
    line-height: 0;
    margin-top: -120px;
  }

  .curved-separator svg {
    width: 100%;
    height: 100%;
    display: block;
  }

  .why-choose-section {
    position: relative;
    padding: 6rem 0;
    background: #1e3a8a;
    overflow: hidden;
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
  }

  .section-title {
    text-align: center;
    font-size: clamp(2rem, 4vw, 3rem);
    font-weight: 800;
    margin-bottom: 3rem;
    color: white;
  }

  .carousel-container {
    position: relative;
    margin-bottom: 3rem;
  }

  .carousel-wrapper {
    overflow: hidden;
    margin: 0 60px;
  }

  .why-choose-grid {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 2rem;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .why-choose-item {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: var(--radius-xl);
    padding: 1rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    width: 350px;
    height: 300px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 2px solid rgba(14, 165, 233, 0.15);
    box-shadow: var(--shadow-lg);
  }

  .item-icon {
    width: 52px;
    height: 52px;
    background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1rem;
    color: white;
    flex-shrink: 0;
  }

  .item-icon svg {
    width: 28px;
    height: 28px;
  }

  .item-title {
    font-size: 1.05rem;
    font-weight: 700;
    color: #1e3a8a;
    margin-bottom: 0.75rem;
    line-height: 1.3;
  }

  .item-description {
    font-size: 0.875rem;
    color: #475569;
    line-height: 1.6;
    margin: 0;
  }

  /* Carousel arrows */
  .carousel-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 48px;
    height: 48px;
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 10;
    color: white;
  }

  .carousel-arrow:hover {
    background: rgba(255, 255, 255, 0.25);
    border-color: rgba(255, 255, 255, 0.5);
    transform: translateY(-50%) scale(1.1);
  }

  .carousel-arrow-left {
    left: 0;
  }

  .carousel-arrow-right {
    right: 0;
  }

  .carousel-arrow:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .carousel-arrow:disabled:hover {
    background: rgba(255, 255, 255, 0.15);
    color: white;
    transform: translateY(-50%);
  }

  /* Doctor Info Block */
  .doctor-info-block {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: var(--radius-2xl);
    padding: 4rem 3rem;
    margin: 0 2rem 4rem;
    border: 2px solid rgba(30, 58, 138, 0.1);
    box-shadow: var(--shadow-2xl);
  }

  .doctor-info-content {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 4rem;
    align-items: center;
  }

  .doctor-image {
    position: relative;
  }

  .doctor-image img {
    width: 100%;
    height: auto;
    border-radius: var(--radius-2xl);
    box-shadow: var(--shadow-2xl);
    border: 4px solid white;
  }

  .doctor-details {
    color: #1e3a8a;
  }

  .doctor-name {
    font-size: 2.5rem;
    font-weight: 800;
    margin-bottom: 0.5rem;
    color: #1e3a8a;
  }

  .doctor-title {
    font-size: 1.25rem;
    color: #475569;
    margin-bottom: 2.5rem;
    font-weight: 600;
  }

  .credentials-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 2.5rem;
  }

  .credential-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    color: #475569;
    font-size: 1rem;
    line-height: 1.6;
  }

  .credential-item svg {
    flex-shrink: 0;
    margin-top: 0.2rem;
    color: var(--color-secondary);
  }

  .cta-button {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem 2rem;
    background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
    color: white;
    text-decoration: none;
    font-size: 1.125rem;
    font-weight: 700;
    border-radius: var(--radius-full);
    transition: all 0.3s ease;
    box-shadow: var(--shadow-lg);
  }

  .cta-button:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-2xl);
  }

  .cta-button svg {
    transition: transform 0.3s ease;
  }

  .cta-button:hover svg {
    transform: translateX(4px);
  }

  /* Tablet */
  @media (max-width: 968px) {
    .section-title {
      margin-bottom: 2rem;
    }

    .carousel-wrapper {
      margin: 0 50px;
    }

    .carousel-arrow {
      width: 40px;
      height: 40px;
    }

    .doctor-info-block {
      padding: 3rem 2rem;
      margin: 0 1rem 3rem;
    }

    .doctor-info-content {
      grid-template-columns: 1fr;
      gap: 3rem;
      text-align: center;
    }

    .doctor-image {
      max-width: 300px;
      margin: 0 auto;
    }

    .credentials-list {
      align-items: center;
    }

    .credential-item {
      justify-content: center;
      text-align: left;
      max-width: 500px;
    }

    .cta-button {
      margin: 0 auto;
    }
  }

  /* Mobile */
  @media (max-width: 640px) {
    .why-choose-section {
      padding: 4rem 0 0;
    }

    .section-title {
      margin-bottom: 2rem;
    }

    .carousel-wrapper {
      margin: 0 40px;
    }

    .why-choose-grid {
      gap: 1.5rem;
    }

    .why-choose-item {
      padding: 1.5rem;
    }

    .item-icon {
      width: 48px;
      height: 48px;
      height: 56px;
    }

    .carousel-arrow {
      width: 36px;
      height: 36px;
    }

    .carousel-dots {
      margin-bottom: 2rem;
    }

    .doctor-info-block {
      padding: 2rem 1.5rem;
      margin: 0 1rem 2rem;
    }

    .doctor-name {
      font-size: 2rem;
    }

    .doctor-title {
      font-size: 1.125rem;
      margin-bottom: 2rem;
    }

    .credential-item {
      font-size: 0.95rem;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .why-choose-grid {
      transition: none;
    }
    
    .why-choose-item,
    .carousel-arrow,
    .carousel-dot {
      transition: none;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const grid = document.querySelector('.why-choose-grid') as HTMLElement;
    const items = document.querySelectorAll('.why-choose-item');
    const leftArrow = document.querySelector('.carousel-arrow-left') as HTMLButtonElement;
    const rightArrow = document.querySelector('.carousel-arrow-right') as HTMLButtonElement;
    const dotsContainer = document.querySelector('.carousel-dots') as HTMLElement;
    
    if (!grid || !items.length || !leftArrow || !rightArrow || !dotsContainer) return;
    
    // Check if already initialized
    if (grid.dataset.initialized === 'true') return;
    grid.dataset.initialized = 'true';
    
    const totalItems = items.length;
    const itemsPerView = 3;
    const totalPages = totalItems; // Each item is a page for circular behavior
    let currentPage = 0;
    
    // Clone items for infinite loop
    items.forEach(item => {
      const clone = item.cloneNode(true) as HTMLElement;
      grid.appendChild(clone);
    });
    
    // Create dots (one for each original item)
    for (let i = 0; i < totalItems; i++) {
      const dot = document.createElement('button');
      dot.classList.add('carousel-dot');
      dot.setAttribute('aria-label', `Go to slide ${i + 1}`);
      if (i === 0) dot.classList.add('active');
      dot.addEventListener('click', () => goToPage(i));
      dotsContainer.appendChild(dot);
    }
    
    const dots = document.querySelectorAll('.carousel-dot');
    
    function updateCarousel(animate = true) {
      if (!animate) {
        grid.style.transition = 'none';
      }
      
      const offset = currentPage * (100 / (totalItems * 2)) * itemsPerView;
      grid.style.transform = `translateX(-${offset}%)`;
      
      // Update dots (circular)
      const activeDot = currentPage % totalItems;
      dots.forEach((dot, index) => {
        dot.classList.toggle('active', index === activeDot);
      });
      
      if (!animate) {
        setTimeout(() => {
          grid.style.transition = 'transform 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
        }, 50);
      }
    }
    
    function goToPage(page: number) {
      currentPage = page;
      updateCarousel();
      
      // Reset to original position when reaching clones
      setTimeout(() => {
        if (currentPage >= totalItems) {
          currentPage = currentPage % totalItems;
          updateCarousel(false);
        }
      }, 500);
    }
    
    leftArrow.addEventListener('click', () => {
      currentPage = currentPage - 1;
      if (currentPage < 0) {
        currentPage = totalItems - 1;
        grid.style.transition = 'none';
        const offset = totalItems * (100 / (totalItems * 2)) * itemsPerView;
        grid.style.transform = `translateX(-${offset}%)`;
        setTimeout(() => {
          grid.style.transition = 'transform 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
          currentPage = totalItems - 1;
          updateCarousel();
        }, 50);
      } else {
        updateCarousel();
      }
    });
    
    rightArrow.addEventListener('click', () => {
      currentPage = currentPage + 1;
      updateCarousel();
      
      if (currentPage >= totalItems) {
        setTimeout(() => {
          currentPage = 0;
          updateCarousel(false);
        }, 500);
      }
    });
    
    updateCarousel();
  });
</script>
