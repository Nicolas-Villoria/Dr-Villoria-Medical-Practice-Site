---
// src/components/Treatments.astro
---

<section id="treatments" class="treatments-section">
  <div class="container">
    <h2 class="section-title transition-item">Guía de Salud</h2>
    <div class="treatments-list">
      <div class="treatment-card transition-item" data-delay="100">
        <div class="treatment-header" data-treatment="reflujo">
          <div class="treatment-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12c0 5.5-4.5 10-10 10S2 17.5 2 12 6.5 2 12 2s10 4.5 10 10z"></path><path d="M18 12H6"></path><path d="M12 18V6"></path></svg>
          </div>
          <div class="treatment-content">
            <h3 class="treatment-title">Reflujo gastro-esofágico</h3>
            <p class="treatment-description">Descripción del tratamiento para el reflujo gastro-esofágico.</p>
          </div>
          <div class="treatment-toggle">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>
          </div>
        </div>
        
        <div class="treatment-recommendations" id="reflujo-recommendations">
          <div class="recommendations-content">
            <h4>Recomendaciones para evitar reflujo gastro-esofágico</h4>
            <p>No siempre somos capaces de identificar las causas que originan el reflujo gastro-esofágico, pero hay una serie de medidas básicas que suelen ser útiles de forma genérica:</p>
            <ul>
              <li>Evitar consumo de comidas copiosas.</li>
              <li>Evitar la ingesta de grasas, cacao, chocolate, café, cítricos, alcohol, bebidas gaseosas, cebolla y especias.</li>
              <li>Controlar el sobrepeso.</li>
              <li>Evitar el consumo de tabaco y reducir el consumo de alcohol.</li>
              <li>Evitar el ejercicio físico intenso.</li>
              <li>Si se padecen síntomas por la noche, es conveniente evitar estirarse en la cama tras menos de 2-3 horas después de la cena, y puede ser útil dormir sobre el lado izquierdo y con la cabecera elevada.</li>
            </ul>
          </div>
        </div>
      </div>
      
      <div class="treatment-card transition-item" data-delay="200">
        <div class="treatment-header" data-treatment="nutricional">
          <div class="treatment-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.89 1.45l8 4A2 2 0 0 1 22 7.24v9.53a2 2 0 0 1-1.11 1.79l-8 4a2 2 0 0 1-1.79 0l-8-4a2 2 0 0 1-1.1-1.8V7.24a2 2 0 0 1 1.11-1.79l8-4a2 2 0 0 1 1.78 0z"></path><polyline points="2.32 6.16 12 11 21.68 6.16"></polyline><line x1="12" y1="22.76" x2="12" y2="11"></line></svg>
          </div>
          <div class="treatment-content">
            <h3 class="treatment-title">Control nutricional digestivo</h3>
            <p class="treatment-description">Planificación dietética adaptada a cada paciente según su patología digestiva.</p>
          </div>
          <div class="treatment-toggle">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>
          </div>
        </div>
        
        <div class="treatment-recommendations" id="nutricional-recommendations">
          <div class="recommendations-content">
            <h4>Recomendaciones para el control nutricional digestivo</h4>
            <p>Una alimentación adecuada es fundamental para mantener la salud digestiva. Las intolerancias alimentarias requieren un enfoque específico:</p>
            
            <div class="intolerance-tabs">
              <button class="tab-button active" data-tab="lactosa">Intolerancia a la Lactosa</button>
              <button class="tab-button" data-tab="fructosa">Intolerancia a la Fructosa</button>
              <button class="tab-button" data-tab="gluten">Intolerancia al Gluten</button>
            </div>
            
            <div class="tab-content active" id="lactosa-content">
              <div class="intolerance-section">
                <h5>Intolerancia a la Lactosa</h5>
                <p><strong>Alimentos a evitar:</strong></p>
                <ul>
                  <li>Leche de vaca, cabra y oveja</li>
                  <li>Quesos frescos y cremosos</li>
                  <li>Yogures convencionales</li>
                  <li>Helados y cremas</li>
                  <li>Productos de bollería y pastelería que contengan leche</li>
                </ul>
                <p><strong>Alternativas recomendadas:</strong></p>
                <ul>
                  <li>Leches vegetales (almendra, avena, soja, arroz)</li>
                  <li>Quesos curados (manchego, parmesano) en pequeñas cantidades</li>
                  <li>Yogures sin lactosa o de origen vegetal</li>
                  <li>Suplementos de lactasa si es necesario</li>
                </ul>
              </div>
            </div>
            
            <div class="tab-content" id="fructosa-content">
              <div class="intolerance-section">
                <h5>Intolerancia a la Fructosa</h5>
                <p><strong>Alimentos a limitar o evitar:</strong></p>
                <ul>
                  <li>Frutas con alto contenido en fructosa: manzanas, peras, cerezas, mangos</li>
                  <li>Miel y sirope de agave</li>
                  <li>Refrescos y zumos industriales</li>
                  <li>Productos con jarabe de maíz de alta fructosa</li>
                  <li>Cebolla, ajo, alcachofas, espárragos</li>
                </ul>
                <p><strong>Alternativas recomendadas:</strong></p>
                <ul>
                  <li>Frutas con menor contenido en fructosa: plátanos, cítricos, fresas, kiwi</li>
                  <li>Verduras bien toleradas: zanahorias, calabacín, pepino, lechuga</li>
                  <li>Consumir frutas en pequeñas cantidades y junto con otros alimentos</li>
                </ul>
              </div>
            </div>
            
            <div class="tab-content" id="gluten-content">
              <div class="intolerance-section">
                <h5>Intolerancia al Gluten (Enfermedad Celíaca/Sensibilidad no celíaca)</h5>
                <p><strong>Alimentos a evitar completamente:</strong></p>
                <ul>
                  <li>Trigo, cebada, centeno y avena no certificada sin gluten</li>
                  <li>Pan, pasta, galletas y bollería convencional</li>
                  <li>Cerveza y malta</li>
                  <li>Salsas y condimentos que puedan contener gluten</li>
                  <li>Productos procesados con trazas de gluten</li>
                </ul>
                <p><strong>Alternativas recomendadas:</strong></p>
                <ul>
                  <li>Cereales sin gluten: arroz, quinoa, maíz, mijo, amaranto</li>
                  <li>Harinas alternativas: almendra, coco, arroz, tapioca</li>
                  <li>Productos certificados sin gluten</li>
                  <li>Legumbres, carnes, pescados y verduras naturales</li>
                </ul>
              </div>
            </div>
            
            <div class="general-recommendations">
              <h5>Recomendaciones Generales</h5>
              <ul>
                <li>Llevar un diario alimentario para identificar alimentos desencadenantes</li>
                <li>Leer siempre las etiquetas de los productos procesados</li>
                <li>Introducir nuevos alimentos gradualmente</li>
                <li>Consultar con un nutricionista especializado en intolerancias</li>
                <li>Mantener una dieta variada dentro de las restricciones</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      
      <div class="treatment-card transition-item" data-delay="300">
        <div class="treatment-header" data-treatment="cronico">
          <div class="treatment-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect><path d="M9 14h.01"></path><path d="M9 17h.01"></path><path d="M12 16l.01-.011"></path><path d="M12 13l.01-.011"></path><path d="M15 16l.01-.011"></path><path d="M15 13l.01-.011"></path></svg>
          </div>
          <div class="treatment-content">
            <h3 class="treatment-title">Seguimiento crónico de enfermedades intestinales</h3>
            <p class="treatment-description">Control periódico, analíticas y coordinación con otros especialistas para un enfoque integral.</p>
          </div>
          <div class="treatment-toggle">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>
          </div>
        </div>
        
        <div class="treatment-recommendations" id="cronico-recommendations">
          <div class="recommendations-content">
            <h4>Recomendaciones para el manejo de enfermedades intestinales crónicas</h4>
            <p>El seguimiento adecuado de las enfermedades intestinales crónicas requiere un enfoque multidisciplinario:</p>
            <ul>
              <li>Mantener un registro de síntomas y factores desencadenantes.</li>
              <li>Cumplir estrictamente con la medicación prescrita.</li>
              <li>Realizar controles periódicos según las indicaciones médicas.</li>
              <li>Seguir una dieta específica adaptada a la patología (baja en FODMAP, sin gluten, etc.).</li>
              <li>Gestionar el estrés mediante técnicas de relajación o apoyo psicológico.</li>
              <li>Mantener un estilo de vida activo adaptado a las limitaciones.</li>
              <li>Comunicar inmediatamente cualquier cambio significativo en los síntomas.</li>
              <li>Participar en grupos de apoyo si están disponibles.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .treatments-section {
    position: relative;
    padding: 6rem 0;
    overflow: hidden;
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 2rem;
  }
  
  .section-title {
    text-align: center;
    font-size: clamp(2rem, 4vw, 3rem);
    font-weight: 800;
    margin-bottom: 4rem;
    background: linear-gradient(135deg, var(--color-text-primary), var(--color-neutral-700));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    position: relative;
  }
  
  .section-title::after {
    content: '';
    position: absolute;
    bottom: -1rem;
    left: 50%;
    transform: translateX(-50%);
    width: 80px;
    height: 4px;
    background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
    border-radius: var(--radius-full);
  }
  
  .treatments-list {
    display: flex;
    flex-direction: column;
    gap: 2rem;
    max-width: 800px;
    margin: 0 auto;
  }
  
  .treatment-card {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border-radius: var(--radius-xl);
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    border: 1px solid rgba(255, 255, 255, 0.5);
    transition: all 0.3s ease;
  }
  
  .treatment-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-2xl);
    border-color: rgba(14, 165, 233, 0.2);
  }
  
  .treatment-header {
    padding: 2rem;
    display: flex;
    align-items: flex-start;
    gap: 1.5rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  
  .treatment-header:hover {
    background: linear-gradient(135deg, rgba(14, 165, 233, 0.02), rgba(16, 185, 129, 0.02));
  }
  
  .treatment-header.active {
    background: linear-gradient(135deg, rgba(14, 165, 233, 0.05), rgba(16, 185, 129, 0.05));
  }
  
  .treatment-icon {
    background: linear-gradient(135deg, rgba(14, 165, 233, 0.1), rgba(16, 185, 129, 0.1));
    color: var(--color-primary);
    width: 60px;
    height: 60px;
    border-radius: var(--radius-lg);
    display: flex;
    justify-content: center;
    align-items: center;
    flex-shrink: 0;
  }
  
  .treatment-content {
    flex: 1;
  }
  
  .treatment-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--color-text-primary);
    margin: 0 0 0.75rem;
  }
  
  .treatment-description {
    font-size: 1rem;
    color: var(--color-text-secondary);
    line-height: 1.7;
    margin: 0;
  }
  
  .treatment-toggle {
    display: flex;
    align-items: center;
    color: var(--color-primary);
    flex-shrink: 0;
    transition: transform 0.3s ease;
  }
  
  .treatment-toggle.rotated {
    transform: rotate(180deg);
  }
  
  .treatment-recommendations {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease-out;
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.03), rgba(14, 165, 233, 0.03));
  }
  
  .treatment-recommendations.active {
    max-height: 1000px;
    transition: max-height 0.5s ease-in;
  }
  
  .recommendations-content {
    padding: 0 2rem 2rem 2rem;
  }
  
  .recommendations-content h4 {
    color: var(--color-text-primary);
    font-size: 1.2rem;
    font-weight: 700;
    margin: 0 0 1rem 0;
    padding-top: 1rem;
    border-top: 2px solid rgba(14, 165, 233, 0.1);
  }
  
  .recommendations-content p {
    color: var(--color-text-secondary);
    line-height: 1.7;
    margin-bottom: 1rem;
  }
  
  .recommendations-content ul {
    color: var(--color-text-secondary);
    line-height: 1.7;
    padding-left: 1.5rem;
  }
  
  .recommendations-content li {
    margin-bottom: 0.75rem;
  }
  
  .intolerance-section {
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(5px);
    border-radius: var(--radius-lg);
    border-left: 4px solid var(--color-primary);
    box-shadow: var(--shadow-sm);
  }
  
  .intolerance-section h5 {
    color: var(--color-text-primary);
    font-size: 1.1rem;
    margin: 0 0 0.75rem 0;
    font-weight: 700;
  }
  
  .intolerance-section p {
    margin-bottom: 0.5rem;
    font-size: 0.95rem;
  }
  
  .intolerance-section p strong {
    color: var(--color-text-primary);
  }
  
  .intolerance-section ul {
    margin-bottom: 1rem;
    margin-top: 0.5rem;
  }
  
  .intolerance-section li {
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
  }
  
  .general-recommendations {
    margin-top: 2rem;
    padding: 1.5rem;
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.08), rgba(14, 165, 233, 0.08));
    border-radius: var(--radius-lg);
    border-left: 4px solid var(--color-secondary);
    box-shadow: var(--shadow-sm);
  }
  
  .general-recommendations h5 {
    color: var(--color-text-primary);
    font-size: 1.1rem;
    margin: 0 0 0.75rem 0;
    font-weight: 700;
  }
  
  .intolerance-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    border-bottom: 2px solid rgba(14, 165, 233, 0.1);
    flex-wrap: wrap;
  }
  
  .tab-button {
    padding: 0.75rem 1rem;
    background-color: transparent;
    border: none;
    border-bottom: 2px solid transparent;
    color: var(--color-text-muted);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    border-radius: var(--radius-md) var(--radius-md) 0 0;
    font-size: 0.9rem;
  }
  
  .tab-button:hover {
    background: linear-gradient(135deg, rgba(14, 165, 233, 0.05), rgba(16, 185, 129, 0.05));
    color: var(--color-primary);
  }
  
  .tab-button.active {
    color: var(--color-primary);
    border-bottom-color: var(--color-primary);
    background: linear-gradient(135deg, rgba(14, 165, 233, 0.08), rgba(16, 185, 129, 0.08));
  }
  
  .tab-content {
    display: none;
    animation: fadeIn 0.3s ease-in-out;
  }
  
  .tab-content.active {
    display: block;
  }
  
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* Tablet */
  @media (max-width: 968px) {
    .treatments-section {
      padding: 5rem 0;
    }

    .section-title {
      margin-bottom: 3rem;
    }
  }

  /* Mobile */
  @media (max-width: 640px) {
    .treatments-section {
      padding: 4rem 0;
    }
    
    .section-title {
      margin-bottom: 2rem;
    }
    
    .treatment-header {
      flex-direction: column;
      align-items: flex-start;
      padding: 1.5rem;
      gap: 1rem;
    }
    
    .treatment-icon {
      margin-bottom: 0.5rem;
    }
    
    .recommendations-content {
      padding: 0 1.5rem 1.5rem 1.5rem;
    }
    
    .recommendations-content h4 {
      font-size: 1.1rem;
    }
    
    .intolerance-tabs {
      flex-direction: column;
      gap: 0.25rem;
    }
    
    .tab-button {
      padding: 0.6rem 0.8rem;
      font-size: 0.85rem;
      text-align: left;
      border-radius: 4px;
      border-bottom: none;
      border-left: 3px solid transparent;
    }
    
    .tab-button.active {
      border-left-color: var(--color-primary);
      border-bottom-color: transparent;
    }
  }

  /* Transition styles */
  .transition-item {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.8s ease, transform 0.8s ease;
  }

  .transition-item.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  @media (prefers-reduced-motion: reduce) {
    .transition-item {
      transition: none;
      opacity: 1;
      transform: none;
    }
  }
</style>

<script>
  // Intersection Observer for scroll animations
  document.addEventListener('DOMContentLoaded', function() {
    const observerOptions = {
      root: null, // viewport
      rootMargin: '0px',
      threshold: 0.1 // Trigger when at least 10% of the target is visible
    };

    const observer = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const target = entry.target as HTMLElement;
          const delay = target.getAttribute('data-delay') || '0';
          
          setTimeout(() => {
            target.classList.add('is-visible');
          }, parseInt(delay));
          
          // Stop observing after animation
          observer.unobserve(target);
        }
      });
    }, observerOptions);

    // Observe all transition items
    document.querySelectorAll('.transition-item').forEach(item => {
      observer.observe(item);
    });

    // Accordion functionality for treatment cards
    const treatmentHeaders = document.querySelectorAll('.treatment-header');
    
    treatmentHeaders.forEach(header => {
      header.addEventListener('click', function(this: HTMLElement) {
        const treatmentId = this.getAttribute('data-treatment');
        const recommendationsElement = document.getElementById(`${treatmentId}-recommendations`);
        const toggleIcon = this.querySelector('.treatment-toggle');
        
        // Check if currently active
        const isActive = recommendationsElement?.classList.contains('active');
        
        // Close all other recommendations
        document.querySelectorAll('.treatment-recommendations').forEach(rec => {
          rec.classList.remove('active');
        });
        document.querySelectorAll('.treatment-header').forEach(h => {
          h.classList.remove('active');
        });
        document.querySelectorAll('.treatment-toggle').forEach(toggle => {
          toggle.classList.remove('rotated');
        });
        
        // If this wasn't active, open it
        if (!isActive && recommendationsElement) {
          recommendationsElement.classList.add('active');
          this.classList.add('active');
          toggleIcon?.classList.add('rotated');
        }
      });
    });

    // Tab functionality for intolerance types
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabButtons.forEach(button => {
      button.addEventListener('click', function(this: HTMLElement) {
        const targetTab = this.getAttribute('data-tab');
        
        // Remove active class from all buttons and contents
        tabButtons.forEach(btn => btn.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));
        
        // Add active class to clicked button and corresponding content
        this.classList.add('active');
        const targetContent = document.getElementById(`${targetTab}-content`);
        if (targetContent) {
          targetContent.classList.add('active');
        }
      });
    });
  });
</script>
