---
// src/components/Treatments.astro
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

// Get all diets that are not drafts
let sortedDiets: CollectionEntry<'diets'>[] = [];
try {
  const allDiets = await getCollection('diets', ({ data }) => {
    return !data.draft;
  });

  // Sort by featured first, then alphabetically
  sortedDiets = allDiets.sort((a, b) => {
    if (a.data.featured && !b.data.featured) return -1;
    if (!a.data.featured && b.data.featured) return 1;
    return a.data.title.localeCompare(b.data.title);
  });
} catch (error) {
  console.error('Error loading diets collection:', error);
}
---

<section id="treatments" class="treatments-section">
  <div class="container">
    <!-- Diets Section -->
    {sortedDiets.length > 0 && (
      <>
        <h3 class="section-title transition-item">Dietas Especializadas</h3>
        <div class="pill-list">
          {sortedDiets.map((diet, index) => (
            <a href={`/diets/${diet.slug}`} class="pill transition-item" data-delay={`${(index + 1) * 50}`}>
              <span>{diet.data.title}</span>
            </a>
          ))}
        </div>
      </>
    )}
  </div>
</section>

<style>
  .treatments-section {
    position: relative;
    padding: 6rem 0;
    overflow: hidden;
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 2rem;
  }
  
  .section-title {
    text-align: center;
    font-size: clamp(2rem, 4vw, 3rem);
    font-weight: 800;
    margin-bottom: 4rem;
    background: linear-gradient(135deg, var(--color-text-primary), var(--color-neutral-700));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    position: relative;
  }
  
  .section-title::after {
    content: '';
    position: absolute;
    bottom: -1rem;
    left: 50%;
    transform: translateX(-50%);
    width: 80px;
    height: 4px;
    background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
    border-radius: var(--radius-full);
  }

  /* Diets Pill List Styles - Premium Minimal */
  .pill-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin-top: 2rem;
    justify-content: center;
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
  }

  .pill {
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(14, 165, 233, 0.1));
    padding: 0.75rem 1.5rem;
    border-radius: 999px;
    color: #0f766e;
    font-weight: 600;
    font-size: 0.95rem;
    text-decoration: none;
    transition: all 0.2s ease;
    border: 1px solid rgba(16, 185, 129, 0.2);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  }

  .pill:hover {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    border-color: transparent;
  }
  
  /* Tablet */
  @media (max-width: 968px) {
    .treatments-section {
      padding: 5rem 0;
    }

    .section-title {
      margin-bottom: 3rem;
    }

    .pill {
      padding: 0.65rem 1.25rem;
      font-size: 0.9rem;
    }
  }

  /* Mobile */
  @media (max-width: 640px) {
    .treatments-section {
      padding: 4rem 0;
    }
    
    .section-title {
      margin-bottom: 2rem;
    }

    .pill-list {
      gap: 0.65rem;
    }

    .pill {
      padding: 0.6rem 1.1rem;
      font-size: 0.85rem;
    }
  }
</style>

<script>
  // Intersection Observer for scroll animations
  document.addEventListener('DOMContentLoaded', function() {
    const observerOptions = {
      root: null,
      rootMargin: '0px',
      threshold: 0.1
    };

    const observer = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const target = entry.target as HTMLElement;
          const delay = target.getAttribute('data-delay') || '0';
          
          setTimeout(() => {
            target.classList.add('is-visible');
          }, parseInt(delay));
          
          observer.unobserve(target);
        }
      });
    }, observerOptions);

    document.querySelectorAll('.transition-item').forEach(item => {
      observer.observe(item);
    });
  });
</script>
